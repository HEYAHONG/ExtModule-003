# 说明

XL2409可看作MCU与[XL2400P](https://www.xinlinggo.com/pd.jsp?id=42)通过SIP封装在一起，其固件部分主要使用MCU的开发环境。

本工程主要使用PY32F030X8相关软件开发资源(同官方案例中使用的MCU型号)，具体硬件资源如下:

- 64K Flash
- 8K SRAM

# 硬件

## 串口

本工程使用两个串口,分别是串口1与串口2。

其中串口1固定用于控制台(可用于输出日志),串口2用作应用串口。

| 引脚 | 默认功能 | 说明    |
| ---- | -------- | ------- |
| PA2  | U1TX     | 串口1TX |
| PA3  | U1RX     | 串口1RX |
| PA4  | U2TX     | 串口2TX |
| PA5  | U2RX     | 串口2RX |

默认情况下,串口的波特率为115200 8N1。

## LED

默认情况下,本工程定义4个LED(均采用高电平驱动)。

| 引脚 | 默认功能    | 说明                           |
| ---- | ----------- | ------------------------------ |
| PB0  | NET_LED     | 网络状态指示灯                 |
| PB1  | SYS_LED     | 系统状态指示灯                 |
| PA6  | NET_RX_LED  | 网络接收指示灯                 |
| PA7  | NET_TX_LED  | 网络发送成功指示灯             |

## PSRAM

PSRAM为可选硬件(外挂),可用于提供数据存储功能。

对于简单的网络(如点对点网络、星型网络),存储的数据较少,XL2409自带的RAM基本够用。

对于相对复杂的网络(如网状网络、树型网络)，每个带路由功能的节点均需维护一份网络拓扑数据，XL2409的RAM可能不够，此时需要PSRAM用于数据存储。

默认情况下,采用8M的PSRAM。

### 引脚分配

PSRAM采用SPI接口,PSRAM最大速度33M bps。由于XL2409本身速度不高,故而SPI操作无需延时。

| 引脚 | 默认功能   | 说明      |
| ---- | ---------- | --------- |
| PA15 | PSRAM_CSN  | PSRAM片选 |
| PB3  | PSRAM_SCK  | PSRAM时钟 |
| PB4  | PSRAM_MISO | PSRAM SO  |
| PB5  | PSRAM_MOSI | PSRAM SI  |

### 分区

本章节为推荐分区,具体应用可酌情修改。

| 起始地址(16进制) | 大小 | 分区名称说明 |
| ---------------- | ---- | ------------ |
| 0x00000000       | 2M   | 链路         |
| 0x00200000       | 2M   | 网络(系统)   |
| 0x00400000       | 4M   | 用户自定义   |

#### 链路

链路层最多支持256个路由节点与256个终端节点(无路由功能,只能与路由节点通信),因此每个节点的数据库共512项。

由于每个路由节点均需保存一份网络拓扑数据,故而总数据项为512X256=131072项,2M空间时每个数据项可使用16字节(具体定义由实际应用决定)。

#### 网络(系统)

由不同网络(系统)决定。

#### 用户自定义

由用户自行定义。

# 工具

主要使用的操作系统:

- Windows 10及更新版本:Keil MDK5开发MCU程序。

## Keil MDK5

MDK5为集成开发环境，可对MCU的程序进行编译、调试等

MDK5的最低版本为5.29。

### 开发环境配置

安装好Keil MDK5并成功激活后，还需要安装设备支持包[Puya.PY32F0xx_DFP.1.2.3.pack](3rdparty/PY32F0xx_Firmware_V1.4.7/Packs/MDK/Puya.PY32F0xx_DFP.1.2.3.pack)

## arm-none-eabi-gcc

arm-none-eabi-gcc主要使用采用newlib-nano作为C运行库的工具，本工程中一般配合CMake使用.

# 目录说明

- [数字]-[名称]：数字为固件编号，名称为固件名称。
- [3rdparty](3rdparty):第三方源代码。

# 固件列表

- [001-base](001-base):基础模板，采用Keil MDK5编译。